buildPack: go
pipelineConfig:
  pipelines:
    pullRequest:
      pipeline:
        stages:
          - name: ci
            steps:
              - name: test
                command: make test
              - name: build
                command: make build
    release:
      pipeline:
        stages:
          - name: release
            steps:
              - name: test
                command: make test
              - name: build
                command: make build
              - name: container-build
                command: skaffold build
                env:
                  - name: DOCKER_REGISTRY
                    value: harbor.corp.angoo.io
                  - name: APP_NAME
                    value: timelogger
              - name: promote
                command: jx promote -b --all-auto --timeout 1h
                env:
                  - name: VERSION
                    value: ${VERSION}

# 资源限制配置
pod:
  containers:
    - name: build
      resources:
        limits:
          cpu: "1"
          memory: "2Gi"
        requests:
          cpu: "0.5"
          memory: "1Gi"